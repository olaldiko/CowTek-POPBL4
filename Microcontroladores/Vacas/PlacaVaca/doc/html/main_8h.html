<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Cow board: main.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Cow board
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">CowTek cow board main application.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('main_8h.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">main.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stm32f4xx.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;inc/USART_API.h&quot;</code><br />
<code>#include &quot;inc/DS18B20_API.h&quot;</code><br />
<code>#include &quot;inc/GPS_API.h&quot;</code><br />
<code>#include &quot;inc/WATCHDOG_API.h&quot;</code><br />
<code>#include &quot;inc/SLEEP_API.h&quot;</code><br />
</div>
<p><a href="main_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aebf99e3a4120f931ce1e4914ae60ea91"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#aebf99e3a4120f931ce1e4914ae60ea91">BOARD_ID</a>&#160;&#160;&#160;20</td></tr>
<tr class="memdesc:aebf99e3a4120f931ce1e4914ae60ea91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Board ID.  <a href="#aebf99e3a4120f931ce1e4914ae60ea91">More...</a><br /></td></tr>
<tr class="separator:aebf99e3a4120f931ce1e4914ae60ea91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bf922bafaf33ecb7213f676b8c33c62"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a4bf922bafaf33ecb7213f676b8c33c62">SEN_TEMPC_ID</a>&#160;&#160;&#160;3</td></tr>
<tr class="memdesc:a4bf922bafaf33ecb7213f676b8c33c62"><td class="mdescLeft">&#160;</td><td class="mdescRight">DS18B20 temperature sensor ID.  <a href="#a4bf922bafaf33ecb7213f676b8c33c62">More...</a><br /></td></tr>
<tr class="separator:a4bf922bafaf33ecb7213f676b8c33c62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2400c3c05a7edced9b2bd1cdfcc2c6ed"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a2400c3c05a7edced9b2bd1cdfcc2c6ed">SEN_GPS_LAT_ID</a>&#160;&#160;&#160;4</td></tr>
<tr class="memdesc:a2400c3c05a7edced9b2bd1cdfcc2c6ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPS Latitude data ID.  <a href="#a2400c3c05a7edced9b2bd1cdfcc2c6ed">More...</a><br /></td></tr>
<tr class="separator:a2400c3c05a7edced9b2bd1cdfcc2c6ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64ce0dd854d3def7f64192232f5d02be"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a64ce0dd854d3def7f64192232f5d02be">SEN_GPS_LON_ID</a>&#160;&#160;&#160;5</td></tr>
<tr class="memdesc:a64ce0dd854d3def7f64192232f5d02be"><td class="mdescLeft">&#160;</td><td class="mdescRight">GPS Longitude data ID.  <a href="#a64ce0dd854d3def7f64192232f5d02be">More...</a><br /></td></tr>
<tr class="separator:a64ce0dd854d3def7f64192232f5d02be"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a1c750a1586c9c682b7e184a7f37b365d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1c750a1586c9c682b7e184a7f37b365d"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><b>fsm_type</b> { <br />
&#160;&#160;<b>INIT_S</b>, 
<b>IDLE_S</b>, 
<b>CAPTURE_S</b>, 
<b>SEND_S</b>, 
<br />
&#160;&#160;<b>ERROR_S</b>
<br />
 }</td></tr>
<tr class="separator:a1c750a1586c9c682b7e184a7f37b365d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0eea0fc32138d47b4b4cc8cf425cc0fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a0eea0fc32138d47b4b4cc8cf425cc0fa">initState</a> (void)</td></tr>
<tr class="memdesc:a0eea0fc32138d47b4b4cc8cf425cc0fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization state of the board.  <a href="#a0eea0fc32138d47b4b4cc8cf425cc0fa">More...</a><br /></td></tr>
<tr class="separator:a0eea0fc32138d47b4b4cc8cf425cc0fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ddfd460646f68782765c4c96e07dd50"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a6ddfd460646f68782765c4c96e07dd50">idleState</a> (void)</td></tr>
<tr class="memdesc:a6ddfd460646f68782765c4c96e07dd50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Idle state of the board.  <a href="#a6ddfd460646f68782765c4c96e07dd50">More...</a><br /></td></tr>
<tr class="separator:a6ddfd460646f68782765c4c96e07dd50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ac861ce5a7c4dd4eda955548b5fa655"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a0ac861ce5a7c4dd4eda955548b5fa655">captureState</a> (void)</td></tr>
<tr class="memdesc:a0ac861ce5a7c4dd4eda955548b5fa655"><td class="mdescLeft">&#160;</td><td class="mdescRight">Capture state of the board.  <a href="#a0ac861ce5a7c4dd4eda955548b5fa655">More...</a><br /></td></tr>
<tr class="separator:a0ac861ce5a7c4dd4eda955548b5fa655"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7083be845da4b76d30054ad43a8bcb6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#af7083be845da4b76d30054ad43a8bcb6">sendState</a> (void)</td></tr>
<tr class="memdesc:af7083be845da4b76d30054ad43a8bcb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send state of the board.  <a href="#af7083be845da4b76d30054ad43a8bcb6">More...</a><br /></td></tr>
<tr class="separator:af7083be845da4b76d30054ad43a8bcb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5edd8ea70fba68952ed2d8fde9c4314"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab5edd8ea70fba68952ed2d8fde9c4314"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#ab5edd8ea70fba68952ed2d8fde9c4314">errState</a> (void)</td></tr>
<tr class="memdesc:ab5edd8ea70fba68952ed2d8fde9c4314"><td class="mdescLeft">&#160;</td><td class="mdescRight">Error state of the board. <br /></td></tr>
<tr class="separator:ab5edd8ea70fba68952ed2d8fde9c4314"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7884055e8bdd92fa30a61314e92c8b87"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7884055e8bdd92fa30a61314e92c8b87"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a7884055e8bdd92fa30a61314e92c8b87">initWatchDog</a> (void)</td></tr>
<tr class="memdesc:a7884055e8bdd92fa30a61314e92c8b87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the watchdog with the desired settings. <br /></td></tr>
<tr class="separator:a7884055e8bdd92fa30a61314e92c8b87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf393b0b8ad2e298caa7c38d8a0ecf1d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abf393b0b8ad2e298caa7c38d8a0ecf1d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#abf393b0b8ad2e298caa7c38d8a0ecf1d">enableIRQs</a> (void)</td></tr>
<tr class="memdesc:abf393b0b8ad2e298caa7c38d8a0ecf1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables the IRQs of the two USARTs. <br /></td></tr>
<tr class="separator:abf393b0b8ad2e298caa7c38d8a0ecf1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cc8baed101eef9465da546d3121bbdf"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4cc8baed101eef9465da546d3121bbdf"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a4cc8baed101eef9465da546d3121bbdf">disableIRQs</a> (void)</td></tr>
<tr class="memdesc:a4cc8baed101eef9465da546d3121bbdf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disables the IRQs of the two USARTs. <br /></td></tr>
<tr class="separator:a4cc8baed101eef9465da546d3121bbdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a746514949644f26d47ff05ac1de1bafa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main_8h.html#a746514949644f26d47ff05ac1de1bafa">prepareMsg</a> (char *<a class="el" href="main_8c.html#a1dca96dc45819b46f2c1aae81df669da">msg</a>, uint8_t sensor, float value)</td></tr>
<tr class="memdesc:a746514949644f26d47ff05ac1de1bafa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares the message with the correct format to be sent.  <a href="#a746514949644f26d47ff05ac1de1bafa">More...</a><br /></td></tr>
<tr class="separator:a746514949644f26d47ff05ac1de1bafa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="aebf99e3a4120f931ce1e4914ae60ea91"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BOARD_ID&#160;&#160;&#160;20</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Board ID. </p>

</div>
</div>
<a class="anchor" id="a2400c3c05a7edced9b2bd1cdfcc2c6ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEN_GPS_LAT_ID&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GPS Latitude data ID. </p>

</div>
</div>
<a class="anchor" id="a64ce0dd854d3def7f64192232f5d02be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEN_GPS_LON_ID&#160;&#160;&#160;5</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GPS Longitude data ID. </p>

</div>
</div>
<a class="anchor" id="a4bf922bafaf33ecb7213f676b8c33c62"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEN_TEMPC_ID&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>DS18B20 temperature sensor ID. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0ac861ce5a7c4dd4eda955548b5fa655"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void captureState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Capture state of the board. </p>
<p>Will first read the ds18 sensor with the interrupts disabled for more accurate timing. After that, it will get the GPS position and re-enable interrupts. Will put the FSM in send state. </p>

</div>
</div>
<a class="anchor" id="a6ddfd460646f68782765c4c96e07dd50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void idleState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Idle state of the board. </p>
<p>In this state, the board will first restart the watchdog counter and then put the board into sleep mode for 25 sec. After waking up, it will wait for 5secs to fill the usart buffer with fresh gps data, and finally, after restarting the Watchdog, it will put the FSM in capture state. </p>

</div>
</div>
<a class="anchor" id="a0eea0fc32138d47b4b4cc8cf425cc0fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialization state of the board. </p>
<p>In this state, the board will initialize the DS18 sensor, watchdog, sleep api, USART and USART6 and the GPS. Finally it will start the Watchdog countdown and put the FSM in the idle state. </p>

</div>
</div>
<a class="anchor" id="a746514949644f26d47ff05ac1de1bafa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void prepareMsg </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>sensor</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepares the message with the correct format to be sent. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The pointer where the message will be stored. </td></tr>
    <tr><td class="paramname">sensor</td><td>The sensor ID. </td></tr>
    <tr><td class="paramname">value</td><td>The value generated by that sensor. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="af7083be845da4b76d30054ad43a8bcb6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendState </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send state of the board. </p>
<p>Will prepare the temp, gps lat and lon messages, and send them via usart. Will put the FSM in idle mode again. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="main_8h.html">main.h</a></li>
    <li class="footer">Generated on Fri Jun 12 2015 01:50:53 for Cow board by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
